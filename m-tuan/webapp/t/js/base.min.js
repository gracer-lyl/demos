var DP=window.DP||{};DP.namespace=function(){var d=arguments,e=null,a,c,b;for(a=0;a<d.length;++a){b=d[a].split(".");e=DP;for(c=b[0]==="DP"?1:0;c<b.length;++c)e[b[c]]=e[b[c]]||{},e=e[b[c]]}return e};DP.namespace("util");DP.namespace("Cookie");DP.util={uniqArray:function(d){var e=[],a={},c,b,f=d.length;if(f<2)return d;for(c=0;c<f;c++)b=d[c],a[b]!==1&&(e.push(b),a[b]=1);return e},isGeolocationSupported:function(){return navigator.geolocation?true:false},isLocalStorageSupported:function(){try{return"localStorage"in window&&window.localStorage!==null}catch(d){return false}}};DP.Cookie={set:function(d,e,a){var c=new Date;c.setTime(c.getTime()+a*6E4);document.cookie=d+"="+encodeURIComponent(e)+";expires="+c.toGMTString()},get:function(d){d=document.cookie.match(RegExp("(^| )"+d+"=([^;]*)(;|$)"));return d!=null?decodeURIComponent(d[2]):null}};(function(d,e,a){function c(a,c){var b=e.createElement(a||"div"),f;for(f in c)b[f]=c[f];return b}function b(a){for(var c=1,b=arguments.length;c<b;c++)a.appendChild(arguments[c]);return a}function f(a,c,b,f){var d=["opacity",c,~~(a*100),b,f].join("-"),b=0.01+b/f*100,f=Math.max(1-(1-a)/c*(100-b),a),g=m.substring(0,m.indexOf("Animation")).toLowerCase();o[d]||(k.insertRule("@"+(g&&"-"+g+"-"||"")+"keyframes "+d+"{0%{opacity:"+f+"}"+b+"%{opacity:"+a+"}"+(b+0.01)+"%{opacity:1}"+(b+c)%100+"%{opacity:"+a+"}100%{opacity:"+f+"}}",k.cssRules.length),o[d]=1);return d}function g(c,b){var f=c.style,d,g;if(f[b]!==a)return b;b=b.charAt(0).toUpperCase()+b.slice(1);for(g=0;g<n.length;g++)if(d=n[g]+b,f[d]!==a)return d}function h(a,b){for(var c in b)a.style[g(a,c)||c]=b[c];return a}function i(b){for(var c=1;c<arguments.length;c++){var f=arguments[c],d;for(d in f)b[d]===a&&(b[d]=f[d])}return b}function l(b){for(var a={x:b.offsetLeft,y:b.offsetTop};b=b.offsetParent;)a.x+=b.offsetLeft,a.y+=b.offsetTop;return a}var n=["webkit","Moz","ms","O"],o={},m,k=function(){var a=c("style",{type:"text/css"});b(e.getElementsByTagName("head")[0],a);return a.sheet||a.styleSheet}(),p={lines:12,length:6,width:3,radius:7,rotate:7,corners:1,color:"#555",speed:1,trail:100,opacity:0.25,fps:20,zIndex:2E9,className:"spinner",top:"auto",left:"auto",position:"relative"},j=function q(a){if(!this.spin)return new q(a);this.opts=i(a||{},q.defaults,p)};j.defaults={};i(j.prototype,{spin:function(a){this.stop();var b=this,f=b.opts,d=b.el=h(c(0,{className:f.className}),{position:f.position,width:0,zIndex:f.zIndex}),g=f.radius+f.length+f.width,e,i;a&&(a.insertBefore(d,a.firstChild||null),i=l(a),e=l(d),h(d,{left:(f.left=="auto"?i.x-e.x+(a.offsetWidth>>1):parseInt(f.left,10)+g)+"px",top:(f.top=="auto"?i.y-e.y+(a.offsetHeight>>1):parseInt(f.top,10)+g)+"px"}));d.setAttribute("aria-role","progressbar");b.lines(d,b.opts);if(!m){var j=0,n=f.fps,k=n/f.speed,o=(1-f.opacity)/(k*f.trail/100),p=k/f.lines;(function r(){j++;for(var a=f.lines;a;a--){var c=Math.max(1-(j+a*p)%k*o,f.opacity);b.opacity(d,f.lines-a,c,f)}b.timeout=b.el&&setTimeout(r,~~(1E3/n))})()}return b},stop:function(){var b=this.el;if(b)clearTimeout(this.timeout),b.parentNode&&b.parentNode.removeChild(b),this.el=a;return this},lines:function(a,d){function g(a,b){return h(c(),{position:"absolute",width:d.length+d.width+"px",height:d.width+"px",background:a,boxShadow:b,transformOrigin:"left",transform:"rotate("+~~(360/d.lines*e+d.rotate)+"deg) translate("+d.radius+"px,0)",borderRadius:(d.corners*d.width>>1)+"px"})}for(var e=0,i;e<d.lines;e++)i=h(c(),{position:"absolute",top:1+~(d.width/2)+"px",transform:d.hwaccel?"translate3d(0,0,0)":"",opacity:d.opacity,animation:m&&f(d.opacity,d.trail,e,d.lines)+" "+1/d.speed+"s linear infinite"}),d.shadow&&b(i,h(g("#000","0 0 4px #000"),{top:"2px"})),b(a,b(i,g(d.color,"0 0 1px rgba(0,0,0,.1)")));return a},opacity:function(a,b,c){if(b<a.childNodes.length)a.childNodes[b].style.opacity=c}});(function(){function a(b,f){return c("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',f)}var f=h(c("group"),{behavior:"url(#default#VML)"});!g(f,"transform")&&f.adj?(k.addRule(".spin-vml","behavior:url(#default#VML)"),j.prototype.lines=function(c,f){function d(){return h(a("group",{coordsize:i+" "+i,coordorigin:-e+" "+-e}),{width:i,height:i})}function g(c,i,j){b(k,b(h(d(),{rotation:360/f.lines*c+"deg",left:~~i}),b(h(a("roundrect",{arcsize:f.corners}),{width:e,height:f.width,left:f.radius,top:-f.width>>1,filter:j}),a("fill",{color:f.color,opacity:f.opacity}),a("stroke",{opacity:0}))))}var e=f.length+f.width,i=2*e,j=-(f.width+f.length)*2+"px",k=h(d(),{position:"absolute",top:j,left:j});if(f.shadow)for(j=1;j<=f.lines;j++)g(j,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(j=1;j<=f.lines;j++)g(j);return b(c,k)},j.prototype.opacity=function(a,b,c,f){var r;var q;a=a.firstChild;f=f.shadow&&f.lines||0;if(a&&b+f<a.childNodes.length&&(r=(q=(a=a.childNodes[b+f])&&a.firstChild,a=q)&&a.firstChild,a=r))a.opacity=c}):m=g(f,"animation")})();typeof define=="function"&&define.amd?define(function(){return j}):DP.Spinner=j})(window,document);(function(d,e,a){function c(b){this._options=a.extend({mode:"msg",text:"\u63d0\u793a\u4fe1\u606f",useTap:false,useBtns:false,useClose:false},b||{});this._init()}a.extend(c.prototype,{_init:function(){var b=this,c=b._options,g=a(d);htmlEle=a('<div class="pop-main"><div class="pop-con"><div class="warn"></div><div class="pop-btn"><button class="ok">\u786e\u5b9a</button><button class="del">\u53d6\u6d88</button></div></div></div>');closeEle=a('<div class="close icon-close"><div class="icon-plus-circle"></div><div class="icon-plus-line-1"></div><div class="icon-plus-line-2"></div></div>');warnEle=htmlEle.find(".warn");btnsEle=htmlEle.find(".pop-btn");sureEle=htmlEle.find(".pop-btn .ok");cancelEle=htmlEle.find(".pop-btn .del");sureText=c.sureText;content=c.content;mode=c.mode;text=c.text;cb=c.callback;useBtns=c.useBtns;useClose=c.useClose;bkColor=c.background;action=c.useTap?"tap":"click";oldClassText=htmlEle.attr("class");newClassText=oldClassText.replace(/(msg|alert|confirm)Mode/i,mode+"Mode");htmlEle.attr("class",newClassText);bkColor&&htmlEle.css("background",bkColor);text&&warnEle.html(text);content&&warnEle.append(content);useBtns&&btnsEle.css("display","block");sureText&&sureEle.text(sureText);useClose?(htmlEle.append(closeEle),closeEle.on("click",function(){b.close()})):htmlEle.children().eq(0).css("padding-right",15);a("body").append(htmlEle);sureEle.on("click",function(){a.extend(c,{text:warnEle,content:content});cb&&cb.call(b,c,true)});cancelEle.on("click",function(){b.close()});g.on("resize",function(){setTimeout(function(){b._pos()},500)})},_pos:function(){var a=e.documentElement,c=e.body;this.isHide()||htmlEle.css({top:c.scrollTop+(a.clientHeight-htmlEle.height())/2,left:c.scrollLeft+(a.clientWidth-htmlEle.width())/2})},_cbShow:function(){var a=this._options.onShow;htmlEle.css("opacity","1").addClass("show");a&&a.call(this)},_cbHide:function(){var a=this._options.onHide;this._options.useClose&&closeEle.css("opacity","0");htmlEle.css("opacity","0").addClass("hide");a&&a.call(this)},show:function(){var a=this;a.isShow()?a._cbShow():(htmlEle.css("opacity","0").removeClass("hide"),a._pos(),setTimeout(function(){a._cbShow()},300),setTimeout(function(){htmlEle.animate({opacity:"1"},300,"linear")},1))},hide:function(){var a=this;a.isHide()?a._cbHide():(htmlEle.css("opacity","1").removeClass("show"),setTimeout(function(){a._cbHide()},300),setTimeout(function(){htmlEle.animate({opacity:"0"},300,"linear")},1))},flash:function(a){var c=this;c._options.onShow=function(){setTimeout(function(){c.close()},a)};c.show()},isShow:function(){return htmlEle.hasClass("show")},isHide:function(){return htmlEle.hasClass("hide")},close:function(){htmlEle.remove()}});DP.Notification=new function(){this.flashBox=function(a,f){var d=new c({mode:"msg",text:a});d.flash(f||2E3);return d};this.ajaxBox=function(a,f){var d=new c({mode:"msg",text:a,useClose:f});d.show();return d};this.formBox=function(b,f){var d=new c(a.extend({mode:"msg",text:b},f||{}));d.show();return d}}})(window,document,Zepto);Zepto(function(d){var e={contShow:d("#swipeTop"),swipeTabCont:d("#swipeTopCont"),bodyCont:d("body"),rightCate:d("#rightCate"),category:d("#J_category"),left:-290,height:d("#contShow").height(),bodyH:d("#bodyCont").height(),init:function(){var a=this;a.contShow.find(".nearby-distance a").each(function(c,b){d(b).click(function(){d(this).addClass("distance-cur").siblings().removeClass("distance-cur");d("#swipeCont-"+(c+1)).show().siblings().hide();a.refresh()})})},start:function(a){d("#type-search-"+a).size()&&d("#type-search-"+a).removeClass("hide").siblings().addClass("hide");d("#swipeCont-"+a).show().siblings().hide()},showLeft:function(){var a=this,c=d("#J_navi"),b=d("#J_togglerBar");b.attr("data-status")=="on"&&(b.attr("data-status","off"),d(".slide").each(function(b,g){a.translation(g,{x:0,duration:"0.6s"},function(){c.attr("style","height: 100%; left:0; ");d(g).attr("style","")})}),a.translation(c[0],{x:-250,duration:"0.6s"},function(){d(".slide").unbind()}));window.scroll(0,0);a.rightCate.show();a.contShow.css({"-webkit-backface-visibility":"hidden","-webkit-prespective":"1000","-webkit-transform-style":"preserve-3d"});a.bodyCont.css({"min-height":a.swipeTabCont.height()+200});a.rightCate.css({height:a.bodyCont.height()});a.bodyCont.append('<div id="leftmask" class="right-mask"><div class="infor"><div class="cont"><span class="l"></span><span class="r"></span></div></div></div>');a.translation(a.contShow[0],{x:0,duration:"0.4s"},function(){d("#leftmask").css("height",a.bodyCont.height())})},hideLeft:function(){var a=this;window.scroll(0,0);a.category.removeClass("on").addClass("hide");a.translation(a.rightCate[0],{x:275,duration:"0.4s"},function(){d("#leftmask").remove();a.rightCate.hide();a.bodyCont.attr("style","position:relative");a.rightCate.attr("style","");a.contShow.attr("style","");a.onHide()})},refresh:function(){var a=this;setTimeout(function(){var c=a.swipeTabCont.height()+200;a.bodyCont.css({"min-height":c});a.rightCate.css({"min-height":c})},500)},translation:function(a,c,b){c=d.extend({duration:"0.4s",origin:"0 0"},c||{});a=a.style;!a.webkitTransitionProperty&&(a.webkitTransitionProperty="-webkit-transform");a.webkitTransitionDuration!==c.duration&&(a.webkitTransitionDuration=c.duration);a.webkitTransformOrigin!==c.origin&&(a.webkitTransformOrigin=c.origin);a.webkitBackfaceVisibility!=="hidden"&&(a.webkitBackfaceVisibility="hidden");a.webkitTransformStyle!=="preserve-3d"&&(a.webkitTransformStyle="preserve-3d");if(c.x!=null||c.y!=null)a.webkitTransform="translate("+(c.x?c.x+"px,":"0,")+(c.y?c.y+"px":"0")+")",setTimeout(b,parseFloat(c.duration)*200)},onHide:function(){},onShow:function(){}};DP.overlay=e});DP.namespace("app");DP.namespace("order");(function(d,e){function a(a){this._options=e.extend({price:e("#J_price"),amount:e("#J_amount"),totalPrice:e("#J_totalPrice"),minusBtn:e(".minus"),plusBtn:e(".plus")},a||{});this._init()}e.extend(a.prototype,{_init:function(){var a=this._options;this._plus(a);this._minus(a)},_plus:function(a){var b=a.amount,d=parseFloat(a.price.text());totalPriceEle=a.totalPrice;a.plusBtn.bind("click",function(g){g&&g.preventDefault();var g=parseInt(b.val()),h=parseInt(e(this).attr("data-max")),i=parseInt(e(this).attr("data-maxperuser"));h&&g<h||!i?(b.val(g+1),totalPriceEle.text((d*(g+1)).toFixed(2)),g==h-1?a.plusBtn.css("background-color","#D6D6D6"):a.minusBtn.css("background-color","#909090")):DP.Notification.flashBox("\u672c\u5355\u6bcf\u4eba\u9650\u8d2d"+i+"\u4efd\uff0c\u60a8\u8fd8\u80fd\u8d2d\u4e70"+h+"\u4efd",1E3)})},_minus:function(a){var b=a.amount,d=parseFloat(a.price.text());totalPriceEle=a.totalPrice;a.minusBtn.bind("click",function(g){g&&g.preventDefault();var g=parseInt(b.val()),h=parseInt(e(this).attr("data-min")),i=0;g>h?(i=g-1,g==h+1?a.minusBtn.css("background-color","#D6D6D6"):a.plusBtn.css("background-color","#909090"),b.val(i),totalPriceEle.text((d*i).toFixed(2))):DP.Notification.flashBox("\u672c\u5355\u81f3\u5c11\u8d2d\u4e70"+h+"\u4efd",1E3)})}});d.DP.order.changeAmount=d.DP.changeAmount=a})(window,Zepto);(function(d,e){DP.order.bindmobile=DP.bindmobile={captcha:e("#J_getCaptcha"),phone:e("#J_phoneNum"),code:e("#J_code"),submitBtn:e("#J_bindBtn"),init:function(){var a=this,c=a.submitBtn,b=a.code;a.captcha.bind("click",function(c){c&&c.preventDefault();a._getCaptcha(this)});c.bind("click",function(c){c&&c.preventDefault();c=e.trim(b.val());c===""?DP.Notification.flashBox("\u9a8c\u8bc1\u7801\u4e3a\u7a7a",1E3):/^[0-9a-zA-Z]+$/.test(c)?a._bindAction(a.phone.val(),c):DP.Notification.flashBox("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u9a8c\u8bc1\u7801",1E3)})},_getCaptcha:function(a){var c=this,b=c.phone.val();b==""?DP.Notification.flashBox("\u624b\u673a\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a",1E3):/^(1[3-9][0-9])\d{8}$/.test(b)?e.ajax({type:"POST",url:"/tuan/ajax/bindMobile",data:{mobile:b},dataType:"json",beforeSend:function(){},success:function(b){if(b.code===200)console.log(b.msg.message),c._countDown(a,59);else if(b.code===500)DP.formBox&&DP.formBox.close(),DP.Notification.flashBox(b.msg,1E3);else if(b.code===501)d.location.href="/tuan/errorMsg?errorMsg="+b.msg}}):DP.Notification.flashBox("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801",1E3)},_countDown:function(a,c){if(a){var a=e(a),b=a.find("input"),f=function(){b.val("\u518d\u6b21\u83b7\u53d6("+c+"s)");c-=1;c>0?d.setTimeout(f,1E3):(b.removeAttr("disabled"),a.removeClass("s-rbtn").addClass("s-btn"),b.val("\u83b7\u53d6\u9a8c\u8bc1\u7801"))};b.attr("disabled","disabled");a.removeClass("s-btn").addClass("s-rbtn");d.setTimeout(f,1E3)}},_bindAction:function(a,c,b){var f=this,g={code:c,mobile:a};b&&(g=e.extend(g,{isForce:1}));e.ajax({type:"POST",url:"/tuan/ajax/saveMobile",data:g,dataType:"json",success:function(b){if(b.code===200)DP.formBox&&DP.formBox.close(),DP.Notification.flashBox("\u7ed1\u5b9a\u624b\u673a\u6210\u529f",1E3),d.setTimeout(function(){d.location.href="/tuan/buy/"+DP.Cookie.get("tg_dealid")},1500);else if(b.code===202)DP.formBox&&DP.formBox.close(),DP.formBox=DP.Notification.formBox('<p style="text-align:center;">'+b.msg+"</p>",{content:"",useBtns:true,sureText:"\u786e\u5b9a",callback:function(){f._bindAction(a,c,true)}});else if(b.code===500)DP.formBox&&DP.formBox.close(),DP.Notification.flashBox(b.msg,1E3);else if(b.code===501)d.location.href="/tuan/errorMsg?errorMsg="+b.msg},error:function(){}})}};DP.order.verifymobile=DP.verifymobile={captcha:e("#J_getCaptcha"),code:e("#J_code"),submitBtn:e("#J_bindBtn"),init:function(){var a=this,c=a.submitBtn,b=a.code;a.captcha.bind("click",function(b){b&&b.preventDefault();a._getCaptcha(this)});c.bind("click",function(c){c&&c.preventDefault();c=e.trim(b.val());c===""?DP.Notification.flashBox("\u9a8c\u8bc1\u7801\u4e3a\u7a7a",1E3):/^[0-9a-zA-Z]+$/.test(c)?a._bindAction(c):DP.Notification.flashBox("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u9a8c\u8bc1\u7801",1E3)})},_getCaptcha:function(a){var c=this;e.ajax({type:"POST",url:"/tuan/ajax/verifyMobile",dataType:"json",success:function(b){if(b.code===200)c._countDown(a,59);else if(b.code===500)DP.Notification.flashBox(b.msg,1E3);else if(b.code===501)d.location.href="/tuan/errorMsg?errorMsg="+b.msg},error:function(){}})},_countDown:function(a,c){if(a){var a=e(a),b=a.find("input"),f=function(){b.val("\u518d\u6b21\u83b7\u53d6("+c+"s)");c-=1;c>0?d.setTimeout(f,1E3):(b.removeAttr("disabled"),a.removeClass("s-rbtn").addClass("s-btn"),b.val("\u83b7\u53d6\u9a8c\u8bc1\u7801"))};b.attr("disabled","disabled");a.removeClass("s-btn").addClass("s-rbtn");d.setTimeout(f,1E3)}},_bindAction:function(a){e.ajax({type:"POST",url:"/tuan/ajax/validateCode",data:{code:a},dataType:"json",success:function(a){if(a.code===200)DP.Notification.flashBox(a.msg,1E3),d.location.href="/tuan/buy/"+DP.Cookie.get("tg_dealid");else if(a.code===500)DP.Notification.flashBox(a.msg,1E3);else if(a.code===501)d.location.href="/tuan/errorMsg?errorMsg="+a.msg},error:function(){}})}}})(window,Zepto);DP.order.addressSelector=function(){var d=$("#J_province"),e=$("#J_city"),a=$("#J_district"),c=function(a){return a==1||a==2||a==9||a==22};d.on("change",function(){var d=$(this).val();d>0?$.ajax({type:"POST",url:"/tuan/ajax/getCityList",data:{provinceId:d},dataType:"json",beforeSend:function(){},success:function(g){if(g.code===200){var g=g.cityList,h;e.empty().append('<option value="0">--\u8bf7\u9009\u62e9--</option>');c(d)&&e.empty();g.forEach(function(a){e.append('<option value="'+a.id+'">'+a.name+"</option>");if(c(d))h=a.id});c(d)?b(h):a.empty().append('<option value="0">--\u8bf7\u9009\u62e9--</option>')}else g.code===500&&console.log("many type of errors")},error:function(){}}):(e.empty().append('<option value="0">--\u8bf7\u9009\u62e9--</option>'),a.empty().append('<option value="0">--\u8bf7\u9009\u62e9--</option>'))});var b=function(b){b>0?$.ajax({type:"POST",url:"/tuan/ajax/getDistrictList",data:{cityId:b},dataType:"json",beforeSend:function(){},success:function(b){b.code===200?(b=b.districtList,a.empty().append('<option value="0">--\u8bf7\u9009\u62e9--</option>'),b.forEach(function(b){a.append('<option value="'+b.id+'">'+b.name+"</option>")})):b.code===500&&a.empty().append('<option value="0">--\u8bf7\u9009\u62e9--</option>')},error:function(){}}):a.empty().append('<option value="0">--\u8bf7\u9009\u62e9--</option>')};e.on("change",function(){var a=$(this).val();b(a)})};DP.order.validateAddr=function(){var d=$("#dealform"),e=$("#J_submit"),a=$("#J_province"),c=$("#J_city");$("#J_district");var b=$("#J_detailAddr"),f=$("#J_postcode"),g=$("#J_consignee"),h=$("#J_telphone");e.on("click",function(e){e&&e.preventDefault();a.val()==0?DP.Notification.flashBox("\u7701\u4efd\u4e0d\u80fd\u4e3a\u7a7a",1E3):c.val()==0?DP.Notification.flashBox("\u57ce\u5e02\u4e0d\u80fd\u4e3a\u7a7a",1E3):b.val()==""?DP.Notification.flashBox("\u8be6\u7ec6\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a",1E3):f.val()==""?DP.Notification.flashBox("\u90ae\u7f16\u4e0d\u80fd\u4e3a\u7a7a",1E3):!/^\d{6}$/.test(f.val())||/000000/.test(f.val())?DP.Notification.flashBox("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u90ae\u7f16",1E3):g.val()==""?DP.Notification.flashBox("\u6536\u8d27\u4eba\u4e0d\u80fd\u4e3a\u7a7a",1E3):h.val()==""?DP.Notification.flashBox("\u7535\u8bdd\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a",1E3):/^((1\d{10})|0[\w\W]*)$/.test(h.val())?d.submit():DP.Notification.flashBox("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7535\u8bdd\u53f7\u7801",1E3)})};DP.order.submitOrder=function(){var d=$("#J_submit"),e=$("#J_amount"),a=$("#checkOurForm"),c,b;e.size()&&(c=parseInt(e.prev().attr("data-min")),b=parseInt(e.next().attr("data-max")));d.on("click",function(d){d.preventDefault();_gaq.push(["_trackEvent","buy_order","click",""]);if(e.size()){var g=e.val().trim();if(g==""){DP.Notification.flashBox("\u8d2d\u4e70\u6570\u91cf\u4e0d\u80fd\u4e3a\u7a7a",1E3);return}if(!/^[0-9]{1,}$/.test(g)){DP.Notification.flashBox("\u8d2d\u4e70\u6570\u91cf\u5fc5\u987b\u4e3a\u6570\u5b57",1E3);return}g=parseInt(g);if(g<c){DP.Notification.flashBox("\u672c\u5355\u81f3\u5c11\u8d2d\u4e70"+c+"\u4efd",1E3);return}if(g>b){DP.Notification.flashBox("\u60a8\u8fd8\u80fd\u8d2d\u4e70"+b+"\u4efd",1E3);return}}$.ajax({type:"POST",url:"/tuan/ajax/validateCheckOut",dataType:"json",data:{quantity:e.size()?g:-1},success:function(b){if(b.code===200)a.submit();else if(b.code===500)DP.Notification.flashBox(b.msg,1E3),b.userMax&&(e.next().attr("data-max",b.userMax),$("#J_textBuy").text("\uff08\u53ef\u8d2d\u4e70"+b.userMax+"\u4efd\uff09"));else if(b.code===501)window.location.href="/tuan/errorMsg?errorMsg="+b.msg;else if(b.code===502)window.location.href=b.msg}})})};DP.order.selectCoupon=function(){$("#J_couponList li").click(function(){$(this).find("input[type=radio]")[0].checked=true})};DP.order.selectPayMethod=function(){$(".pay-method li").click(function(){var d=$(this);_gaq.push(["_trackEvent","order_paychannel","click",""]);d.find("input[type=radio]")[0].checked=true})};DP.order.showWarning=function(){var d=$(".warning");d.size()>0&&DP.Notification.flashBox(d.text(),1500)};DP.user={getMoreReceipt:function(){var d=$("#J_moreBtn"),e=$("#J_recepitList");d.on("click",function(a){a&&a.preventDefault();var c=$(this),a=c.attr("data-current");$.ajax({type:"POST",url:"/tuan/ajax/moreReceiptList",data:{currentPage:a},dataType:"json",beforeSend:function(){},success:function(a){if(a.code===200){var d=a.receiptList;c.attr("data-current",a.currentPage);d.length>0&&d.forEach(function(a){e.append("<li><a class=\"item\" onclick=\"_gaq.push(['_trackEvent', 'couponlist_item', 'click', ''])\" title=\"\" href=\"javascript:window.location.href='/tuan/receiptdetail/"+a.receiptId+'\'"><table width="100%" cellpadding="0" cellspacing="0"><tbody><tr><td width="60" valign="top"><div class="surplus">\u5269\u4f59<br><strong>'+a.remainDays+'</strong>&nbsp;\u5929</div></td><td><div class="infor"><h3 class="title">'+a.dealName+'</h3><p class="Fix"><span class="phone">'+a.serialNumber+'</span><span class="time">'+a.endTime+"\u8fc7\u671f</span></p></div></td></tr></tbody></table></a></li>")});a.currentPage>=a.pageCount&&c.addClass("more-default-btn").html('<i class="icon-more"></i>\u5df2\u7ecf\u5230\u5e95\u5566').unbind("click")}else a.code===500&&console.log("many type of errors")},error:function(){}})})}};DP.app={hidePhoneAddrBar:function(){setTimeout(function(){window.scrollTo(0,1)},100)},webAppLink:function(){$("a").click(function(d){if(!$(d.target).hasClass("noDirect"))return window.location=this.getAttribute("href"),false})},goSearch:function(){var d=$("#J_search_toggler"),e=$("#J_search_btn");d.focus(function(){window.location.href="/tuan/search"});e.click(function(){$.trim(d.val())===""&&DP.Notification.flashBox("\u8bf7\u8f93\u5165\u641c\u7d22\u5173\u952e\u5b57")})},fixedBuyBar:function(){if(function(){var a=false;navigator.userAgent.match(/iPhone/i)&&(a=Boolean(navigator.userAgent.match(/OS [5-9]_\d[_\d]* like Mac OS X/i)));navigator.userAgent.match(/Android/i)&&(a=true);return a}()){var d=$("#J_slideBar"),e=$("#J_img").height(),a=$("#J_section");$(window).on("scroll",function(){setTimeout(function(){window.scrollY>=43+e?(!d.hasClass("position-fixed")&&d.addClass("position-fixed"),a.css("margin-top","64px")):(d.hasClass("position-fixed")&&d.removeClass("position-fixed"),a.css("margin-top","0px"))},0)})}},search:function(d){function e(a,b){var c=localStorage.getItem(a),c=c?c.split(","):[];c.push(b);c=DP.util.uniqArray(c);c.length=c.length<25?c.length:25;localStorage.setItem(a,c.join(","))}function a(){var a=localStorage.getItem(i),c=0;g.empty();if(a&&(a=a.split(","),c=a.length,c!==0)){if(c>5)for(var d=c-5;d<c;d++)$('<li><a class="noDirect J_history" href="javascript:void(0)">'+a[d]+"</a></li>").prependTo(g).find(".J_history").click(function(a){a&&a.preventDefault();a=$(this).text();b.val(a);_gaq.push(["_trackEvent","search_history","click",""]);h.submit()});else a.forEach(function(a){$('<li><a class="noDirect J_history" href="javascript:void(0)">'+a+"</a></li>").prependTo(g).find(".J_history").click(function(a){a&&a.preventDefault();a=$(this).text();b.val(a);_gaq.push(["_trackEvent","search_history","click",""]);h.submit()})});$('<li><a id="J_clearHistory" class="noDirect last" href="javascript:void(0)">\u6e05\u9664\u641c\u7d22\u8bb0\u5f55</a></li>').appendTo(g).find("#J_clearHistory").click(function(a){a&&a.preventDefault();localStorage.removeItem(i);g.empty();b.val("")})}}function c(){var b=$("#J_search_input"),f=$.trim(b.val());f===""?(l="",g.empty(),d&&a()):l!=f&&$.ajax({type:"POST",url:"/tuan/ajax/searchSuggestion",data:{keyword:f},dataType:"json",success:function(a){var c=[];g.html("");l=f;a.code===200?(c=a.suggestionList,c.forEach(function(a){$('<li><a class="noDirect" href="javascript:;">'+a.keyword+'</a><span class="fruit-numb">\u7ea6'+a.num+"\u4e2a\u7ed3\u679c</span></li>").prependTo(g).find("a").on("click",function(a){a&&a.preventDefault();a=$(this).text();b.val(a);_gaq.push(["_trackEvent","search_suggest","click",""]);e(i,a);h.submit()})})):g.prepend("<li>\u67e5\u627e\u201c"+f+"\u201d</li>")}});setTimeout(function(){c()},500)}if(DP.util.isLocalStorageSupported()){var b=$("#J_search_input"),f=$("#J_search_btn"),g=$("#J_search_ul"),h=$("#searchForm"),i="searchstorage";b.focusin(function(){d&&a()});var l="";c();f.click(function(a){a&&a.preventDefault();a=$.trim(b.val());a===""?DP.Notification.flashBox("\u8bf7\u8f93\u5165\u641c\u7d22\u5173\u952e\u5b57"):(e(i,a),h.submit())})}},posCity:function(){if(DP.util.isGeolocationSupported()){var d={enableHighAccuracy:true,maximumAge:3E4,timeout:5E3},e=function(a){var b=a.coords.latitude,d=a.coords.longitude;$.ajax({type:"POST",url:"/tuan/locate",data:{lat:b,lng:d},dataType:"json",success:function(a){a.code===200?(a=a.cname,DP.Cookie.set("locallat",b,10),DP.Cookie.set("locallng",d,10),console.log(a)):a.code===500&&console.log("\u65e0\u6cd5\u83b7\u53d6\u60a8\u7684\u4f4d\u7f6e\u4fe1\u606f")},error:function(){console.log("\u65e0\u6cd5\u83b7\u53d6\u60a8\u7684\u4f4d\u7f6e\u4fe1\u606f")}})},a=function(a){switch(a.code){case a.TIMEOUT:console.log("\u94fe\u63a5\u8d85\u65f6");break;case a.PERMISSION_DENIED:console.log("\u60a8\u62d2\u7edd\u4e86\u4f7f\u7528\u4f4d\u7f6e\u5171\u4eab\u670d\u52a1\uff0c\u67e5\u8be2\u5df2\u53d6\u6d88");break;case a.POSITION_UNAVAILABLE:console.log("\u5b9a\u4f4d\u5931\u8d25")}};(!DP.Cookie.get("locallat")||!DP.Cookie.get("locallng"))&&navigator.geolocation.getCurrentPosition(e,a,d)}},locCity:function(){var d=$(".this-city");DP.util.isGeolocationSupported()&&navigator.geolocation.getCurrentPosition(function(e){var a=e.coords.latitude,c=e.coords.longitude;$.ajax({type:"POST",url:"/tuan/locate",data:{lat:a,lng:c},dataType:"json",beforeSend:function(){d.html("<p>\u6b63\u5728\u5b9a\u4f4d...</p>")},success:function(b){if(b.code===200){var e=b.cname,b=b.ename;DP.Cookie.set("locallat",a,10);DP.Cookie.set("locallng",c,10);d.html("<a href=\"javascript:window.location.href='/tuan/"+b+'\'" title="" class="city-links">\u5f53\u524d\u5b9a\u4f4d\u57ce\u5e02<strong>'+e+'</strong><i class="arrow-ent"></i></a>')}else b.code===500&&d.html('<p>\u65e0\u6cd5\u83b7\u53d6\u60a8\u7684\u4f4d\u7f6e\u4fe1\u606f&nbsp; <a class="gray-btn" onclick="DP.app.locCity();">\u91cd\u8bd5</a></p>')},error:function(){d.html('<p>\u65e0\u6cd5\u83b7\u53d6\u60a8\u7684\u4f4d\u7f6e\u4fe1\u606f &nbsp;<a class="gray-btn" onclick="DP.app.locCity();">\u91cd\u8bd5</a></p>')}})},function(e){switch(e.code){case e.TIMEOUT:d.html('<p>\u94fe\u63a5\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5&nbsp;<a class="gray-btn" onclick="DP.app.locCity();">\u91cd\u8bd5</a></p>');break;case e.PERMISSION_DENIED:d.html("<p>\u60a8\u62d2\u7edd\u4e86\u4f7f\u7528\u4f4d\u7f6e\u5171\u4eab\u670d\u52a1\uff0c\u67e5\u8be2\u5df2\u53d6\u6d88</p>");break;case e.POSITION_UNAVAILABLE:d.html('<p>\u5b9a\u4f4d\u5931\u8d25&nbsp;<a class="gray-btn" onclick="DP.app.locCity();">\u91cd\u8bd5</a></p>')}},{enableHighAccuracy:true,maximumAge:3E4,timeout:5E3})},dealOverlay:function(){$(".toggler-bar").each(function(d,e){var a=$(e),c=a.next(),b=c.next();a.click(function(){a.parent().siblings().find("i").removeClass("nearby-up").addClass("nearby-down");a.parent().siblings().find(".distan-tab").addClass("hide");c.attr("class")==="nearby-down"?c.removeClass("nearby-down").addClass("nearby-up"):c.removeClass("nearby-up").addClass("nearby-down");b.hasClass("hide")?b.removeClass("hide"):b.addClass("hide")})});$(".shop-search li").each(function(d,e){$(e).on("click",function(){DP.overlay.start(d+1);DP.overlay.showLeft();$("body > div").click(function(a){a=a.target||a.srcElement;a.nodeName.toUpperCase()==="DIV"&&$(a).attr("id")=="leftmask"&&(DP.overlay.hideLeft(),window.scroll(0,0))});$("#leftmask .infor").click(function(){DP.overlay.hideLeft();window.scroll(0,0)})})})},moreDeal:function(){var d=$("#J_getMoreDeal"),e=$("#J_dealList"),a=$(".shop-search li"),c=$("#J_keyword"),b=$("#J_isToday"),f=function(a){if(a==0)return"";else if(a==1)return'<div class="sub-icon soon"></div>';else if(a==2)return'<div class="sub-icon sold"></div>';else if(a==3)return'<div class="sub-icon new"></div>'};d.on("click",function(d){d&&d.preventDefault();var h=$(this),i="search",d=a.eq(0).attr("data-root"),l=a.eq(0).attr("data-sub"),n=a.eq(1).attr("data-root"),o=a.eq(1).attr("data-sub"),m=a.eq(2).attr("data-sort"),k=h.attr("data-cur"),d={currentPage:k,rootCategory:d,subCategory:l,rootRegion:n,subRegion:o,sort:m};c.size()>0&&($.extend(d,{keyword:c.val()}),i="home");b.size()>0&&$.extend(d,{isToday:b.val()==3?3:0});$.ajax({type:"POST",url:"/tuan/ajax/moreDealGroupList",data:d,dataType:"json",beforeSend:function(){h.addClass("more-default-btn").html("\u52a0\u8f7d\u4e2d")},success:function(a){a.code===200&&(a.dealGroupList.forEach(function(a){var b="",c="",c="";parseInt(a.distance)>0&&(b='<span class="jl">'+a.distance+"</span>");if(a.regionPrefix!="")c=a.regionPrefix,c.length>3&&(c=c.substring(0,3)+"..."),c='<span class="dz">'+c+"</span>";c="<li><a onclick=\"_gaq.push(['_trackEvent', '"+i+"_item', 'click', ''])\" href=\"javascript:window.location.href='/tuan/deal/"+a.id+'\'" class="item"><table width="100%" cellspacing="0" cellpadding="0" class="deal-tab"><tbody><tr><td width="100" valign="top"><img src="'+a.imageUrl+'" class="pic-box"></td><td valign="top"><div class="infor"><h3 class="title">'+a.titleAbstract+'</h3><div class="price"><span class="now">\u00a5'+a.price+'</span><span class="old">\u00a5'+a.marketPrice+'</span></div><div class="Fix"><span class="num">'+a.currentJoin+"\u4eba</span>"+c+b+"</div></div></td></tr></tbody></table>"+f(a.status)+"</a></li>";e.append(c)}),k=parseInt(k)+1,h.attr("data-cur",k),k<a.pageCount?h.removeClass("more-default-btn").html('<i class="icon-more"></i>\u67e5\u770b\u66f4\u591a'):h.addClass("more-default-btn").html('<i class="icon-more"></i>\u5df2\u7ecf\u5230\u5e95\u5566').unbind("click"))},error:function(){}})})},getMoreMerchant:function(){var d=$("#J_shopList");$("#J_moreBtn").on("click",function(e){e&&e.preventDefault();var a=$(this),c=a.attr("data-current"),e=a.attr("data-id"),b=0,f=0,b=DP.Cookie.get("locallat"),f=DP.Cookie.get("locallng");!b&&(b=0);!f&&(f=0);$.ajax({type:"POST",url:"/tuan/getShops",data:{p:c,id:e,lat:b,lng:f},dataType:"json",beforeSend:function(){a.addClass("more-default-btn").html("\u52a0\u8f7d\u4e2d")},success:function(b){if(b.code===200){var e=b.shopList;e.length>0&&e.forEach(function(a){d.append('<div class="Box nom-box shop-box"><h3 class="title">'+a.name+'</h3><span class="distance">'+a.distance+'</span><table width="100%" cellpadding="0" cellspacing="0"><tr><td><div class="infor"><div class="score Fix"><span class="item-rank-rst irr-star'+a.power+'">\u8bc4\u5206:\u4e94\u661f\u5546\u6237</span></div><p><a href="tel:'+a.phone+'">'+a.phone+"</a></p><p>"+a.businessHours+"</p><p>"+a.address+'</p></div></td><td width="55" align="center" valign="middle"><a class="go" href="#"><i class="arrow-ent"></i></a></td></tr></table></div>')});c=parseInt(c)+1;a.attr("data-current",c);c<b.pageCount?a.removeClass("more-default-btn").html('<i class="icon-more"></i>\u67e5\u770b\u66f4\u591a'):a.addClass("more-default-btn").html('<i class="icon-more"></i>\u5df2\u7ecf\u5230\u5e95\u5566').unbind("click")}else b.code===500&&console.log("many type of errors")},error:function(){}})})},slideNavi:function(){function d(a,b,d){b=$.extend({duration:"0.4s",origin:"0 0"},b||{});a=a.style;!a.webkitTransitionProperty&&(a.webkitTransitionProperty="-webkit-transform");a.webkitTransitionDuration!==b.duration&&(a.webkitTransitionDuration=b.duration);a.webkitTransformOrigin!==b.origin&&(a.webkitTransformOrigin=b.origin);a.webkitBackfaceVisibility!=="hidden"&&(a.webkitBackfaceVisibility="hidden");a.webkitTransformStyle!=="preserve-3d"&&(a.webkitTransformStyle="preserve-3d");if(b.x!=null||b.y!=null)a.webkitTransform="translate("+(b.x?b.x+"px,":"0,")+(b.y?b.y+"px":"0")+")",setTimeout(d,parseFloat(b.duration)*500)}var e=$("#J_togglerBar"),a=$("#J_navi");e.on("click",function(c){c&&c.preventDefault();var b=$(this),c=b.attr("data-status");c=="off"?(b.attr("data-status","on"),a.css("min-height","514px"),d(a[0],{x:0,duration:"0.4s"},function(){}),$(".slide").each(function(a,b){d(b,{x:250,duration:"0.4s"},function(){})})):c=="on"&&(b.attr("data-status","off"),$(".slide").each(function(b,c){d(c,{x:0,duration:"0.4s"},function(){a.attr("style","height: 100%; left:0; ");$(c).attr("style","")})}),d(a[0],{x:-250,duration:"0.4s"},function(){}));$(".slide").bind("touchstart touchmove touchend",function(c){c&&c.preventDefault();b.attr("data-status","off");$(".slide").each(function(b,c){d(c,{x:0,duration:"0.4s"},function(){a.attr("style","height: 100%; left:0; ");$(c).attr("style","")})});d(a[0],{x:-250,duration:"0.4s"},function(){$(".slide").unbind()})})})},dealDetails:function(){$("#J_dealDetail").bind("click",function(){var d=$(this);_gaq.push(["_trackEvent","deal_more","click",""]);DP.Notification.formBox('<p style="text-align:center;">\u56fe\u6587\u8be6\u60c5\u9875\u56fe\u7247\u8f83\u591a\uff0c<br/>\u53ef\u80fd\u6d88\u8017\u8f83\u591a\u7f51\u7edc\u6d41\u91cf\uff0c\u662f\u5426\u7ee7\u7eed\uff1f</p>',{content:"",useBtns:true,sureText:"\u786e\u5b9a",callback:function(){this.close();window.location.href="/tuan/deal/moreinfo/"+d.attr("data-id")}})})},returnBack:function(d){d.size()&&d.click(function(d){d&&d.preventDefault();document.referrer!=""&&/(m.alpha.dp|m.51ping.com|m.dianping.com)/.test(document.referrer)?window.history.back():window.location.href="/tuan"})}};